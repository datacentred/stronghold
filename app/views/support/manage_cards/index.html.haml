%h2
  %i.fa.fa-credit-card
  Manage cards

.pull-right
  = link_to 'Add New Card', '', class: 'btn btn-success', 'data-toggle' => "modal", 'data-target' => "#addNewCard"

%table.table.table-striped.table-hover.cards-list
  %thead
    %th
    %th Type
    %th Number (Last 4 Digits)
    %th Name
    %th Expiry
    %th
  %tbody
    - for card in @cards
      %tr
        %td
          - if card.id == @stripe_customer.default_source
            %span.label.label-primary Default
        %td
          %i{class: "fa fa-cc-#{card.brand.downcase}"}
        %td= "**** **** **** #{card.last4}"
        %td= card.name ? card.name : 'NO NAME'
        %td= "#{card.exp_month}/#{card.exp_year}"
        %td
          .pull-right
            - unless card.id == @stripe_customer.default_source
              = link_to 'Set As Default', support_manage_card_path(card.id), class: 'btn btn-info', :data => {:method => :put}
            = link_to 'Remove', support_manage_card_path(card.id), class: 'btn btn-danger', :data => {:confirm => 'Are you sure? This action cannot be undone.', :method => :delete}

.pull-right
  .powered-by-stripe
    %a{href: "https://stripe.com", target: '_blank'}
      = image_tag 'powered_by_stripe.png'

.modal.fade#addNewCard{'tabindex' => "-1", 'role' => "dialog", 'aria-labelledby' => "addNewCard", 'aria-hidden' => "true", 'data-backdrop' => 'static'}
  .modal-dialog
    .modal-content
      = form_tag support_manage_cards_path, id: 'add_new_card' do
        .modal-header
          %button{'type' => "button", 'class' => "close", 'data-dismiss' => "modal", 'aria-hidden' => "true"}
            &times;
          %h4.modal-title#addNewCard
            %i.fa.fa-credit-card
            Add New Card
          %p Please enter your card details
        .modal-body
          #card-display
          .hide.alert.alert-danger#flashes
          #cc-details
            = hidden_field_tag :stripe_customer_id, @stripe_customer.id
            .form-group
              %label Card Number
              .inline
                = text_field_tag :card_number, nil, :class => 'form-control', 'data-stripe' => 'number'
                = text_field_tag :cvc, nil, :size => 4, :placeholder => 'CVC', :class => 'form-control', 'data-stripe' => 'cvc'
            .inline-form-groups
              .form-group#name
                %label Name On Card
                = text_field_tag :name, nil, :class => 'form-control', 'data-stripe' => 'name'
              .form-group#expiry
                %label Expiry Date
                = text_field_tag :expiry, nil, :class => 'form-control', placeholder: 'MM/YYYY'
            = hidden_field_tag :expiry_month, nil, 'data-stripe' => 'exp-month'
            = hidden_field_tag :expiry_year, nil, 'data-stripe' => 'exp-year'
        .modal-footer
          %button.btn.btn-default{'data-toggle' => "modal", 'data-dismiss' => "modal"}
            = t(:cancel)
          = submit_tag 'Add', class: 'btn btn-primary', id: 'submit_button'
