.ticket

  - if can? :modify, Ticket
    %div.btn-group.pull-right
      %button.btn.btn-primary.pull-right{:'ng-click' => "ticketDialogShow()"}
        %i.fa.fa-edit
        New Ticket
    %div.btn-group.pull-right
      %button.btn.btn-default.dropdown-toggle{:type => "button", :'id' => "statusDropdown", :'data-toggle' => "dropdown", :'dropdown-toggle' => ""}
        %i.fa.fa-circle{:'ng-class' => "selectedTicket.status.name"}
        %span
          Status: {{selectedTicket.status.name}}
        %span.caret
      %ul.dropdown-menu{:role => "menu"}
        %li{:'ng-repeat' => "status in statuses"}
          %a{:'href' => "", :'ng-click' => "changeStatus(status)"}
            {{status.name}}
  - else
    %div.btn-group.pull-right
      %i.fa.fa-circle{:'ng-class' => "selectedTicket.status.name"}
        %span
          Status: {{selectedTicket.status.name}}

  %h1 ({{selectedTicket.reference}}) {{selectedTicket.title}}
  %ul.media-list
    %li.media
      %a.pull-left.gravatar
        %img.img-circle{'gravatar-src' => "selectedTicket.email"}
      %div.media-body
        %h4.media-heading
          {{selectedTicket.email}}
        %p
          %em
            Created: {{selectedTicket.time_created | momentDateTime}}; Updated: {{selectedTicket.time_updated | momentDateTime}}
  %h3 Description
  %p{'ng-bind-html' => "selectedTicket.description"}

  %h3 Comments
  %hr

  - if can? :modify, Ticket
    %div.btn-group#comment-button
      %button.btn.btn-default{:'ng-click' => "commentDialogShow()"}
        %i.fa.fa-comment
        Add Comment

  %div.comments
    %div{:'ng-show' => "hasComments(selectedTicket)"}
      %ul.media-list
        %li.media{:'ng-repeat' => ("comment in selectedTicket.comments")}
          %a.pull-left.gravatar
            %img.img-circle{'gravatar-src' => "comment.email"}
          %div.media-body
            %h4.media-heading
              {{comment.email}}
            %p
              %em
                {{comment.time | momentDateTime}}
            %p{'ng-bind-html' => "comment.content"}
    %div{:'ng-show' => "!hasComments(selectedTicket)"}
      There are no comments yet.

.modal.fade{'id' => 'newComment', 'tabindex' => "-1", 'role' => "dialog", 'aria-labelledby' => 'newComment', 'aria-hidden' => "true"}
  .modal-dialog
    .modal-content
      .modal-header
        %button{'type' => "button", 'class' => "close", 'data-dismiss' => "modal", 'aria-hidden' => "true"}
          &times;
        %h4.modal-title
          %i.fa.fa-comment
          Add A Comment
        %p= t(:ticket_comment_directions)
      .modal-body
        .input-group
          %span.input-group-addon
            %i.fa.fa-comment
          = text_area_tag :new_comment_text, nil, placeholder: "What's on your mind?", class: "form-control", autofocus: true
      .modal-footer
        %button.btn.btn-default{:'ng-click' => 'commentDialogCancel()'}
          = t(:cancel)
        %button.btn.btn-primary{:'ng-click' => 'commentDialogSubmit()'}
          = t(:submit)